<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerAdmin marvin@hamath.de
    ServerName hamath.de
    DocumentRoot /var/www/html
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined

	<Directory /var/www/html>
		Options FollowSymLinks
		Require all granted
	</Directory>

SSLCertificateFile /etc/letsencrypt/live/cloud.hamath.de/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/cloud.hamath.de/privkey.pem
Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>
<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerAdmin marvin@hamath.de
    ServerName cloud.hamath.de
    DocumentRoot /var/www/cloud
    ErrorLog /var/log/apache2/cloud.error.log
    CustomLog /var/log/apache2/cloud.access.log combined

  <Directory /var/www/cloud/>
    Require all granted
    AllowOverride All
    Options FollowSymLinks MultiViews

    <IfModule mod_headers.c>
      Header always set Strict-Transport-Security "max-age=15552000; includeSubDomains"
    </IfModule>

    <IfModule mod_dav.c>
      Dav off
    </IfModule>
  </Directory>

SSLCertificateFile /etc/letsencrypt/live/cloud.hamath.de/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/cloud.hamath.de/privkey.pem
Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>
<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerAdmin marvin@hamath.de
    ServerName www.hamath.de
    DocumentRoot /var/www/html
    ErrorLog /var/log/apache2/www.error.log
    CustomLog /var/log/apache2/www.access.log combined

	<Directory /var/www/html>
		Options FollowSymLinks
		Require all granted
	</Directory>

SSLCertificateFile /etc/letsencrypt/live/cloud.hamath.de/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/cloud.hamath.de/privkey.pem
Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>
<IfModule mod_ssl.c>
<VirtualHost *:443>
	ServerAdmin marvin@hamath.de
	ServerName erp.hamath.de
	DocumentRoot /var/www/erpnext/frappe-bench/sites/erp.hamath.de/
	ErrorLog /var/log/apache2/erp.error.log
	CustomLog /var/log/apache2/erp.access.log combined

	ProxyPreserveHost On
	ProxyRequests Off
	ProxyTimeout 120
	ProxyPass "/.well-known/" "!"
	ProxyPass "/AutoDiscover/" "!"
	ProxyPass "/mail/" "!"
	ProxyPass "/cgi-bin/" "!"
	ProxyPass "/assets/" "!"
	ProxyPass "/files/" "!"
	
	RewriteEngine On
	RewriteCond %{REQUEST_URI}  ^/socket.io               [NC]
	RewriteCond %{QUERY_STRING} transport=polling         [NC]
	RewriteRule /(.*) http://localhost:9000/socket.io/$1  [P,L]
	RequestHeader set Host "erp.hamath.de"
	RequestHeader set X-Frappe-Site-Name "erp.hamath.de"
	ProxyPass "/socket.io" "ws://localhost:9000/socket.io/"
	ProxyPassReverse "/socket.io" "ws://localhost:9000/socket.io/"
	<Location "/socket.io">
		RequestHeader set X-Frappe-Site-Name "erp.hamath.de"
	</Location>
	
	Alias "/assets" "/var/www/erpnext/frappe-bench/sites/assets"
	<Directory /var/www/erpnext/frappe-bench/sites/assets>
		Options FollowSymLinks
		Require all granted
	</Directory>
	Alias "/files" "/var/www/erpnext/frappe-bench/sites/erp.hamath.de/public/files"
	<Directory /var/www/erpnext/frappe-bench/sites/erp.hamath/public/files>
		Options FollowSymLinks
		Require all granted
	</Directory>
	ProxyPass "/"  "http://localhost:8000/"
	ProxyPassReverse "/"  "http://localhost:8000/"
	<Location "/">
		RequestHeader set X-Frappe-Site-Name "erp.hamath.de"
	</Location>

</VirtualHost>
</IfModule>
